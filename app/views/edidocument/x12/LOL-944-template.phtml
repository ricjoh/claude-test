<?php ob_start(); ?>
ISA*00*          *00*          *01*004798716      *08*<?= $data['ISAReceiverID'] ?>*<?= date('ymd') ?>*<?= date('Hi') ?>*U*00401*<?= $data['ISACtrlNo'] ?>*0*<?= $data['usageIndicator'] ?>*>~
GS*RE*004798716*<?= $data['GSRecCode'] ?>*<?= date('Ymd') ?>*<?= date('Hi') ?>*<?= $data['GSCtrlNo'] ?>*X*004010~
ST*944*<?= $data['STCtrlNo'] ?>~
W17*F*<?= $data['ReceiveDate'] ?>*<?= $data['ReceiveNumber'] ?>*<?= $data['VendorOrderNumber'] ?>~
N1*WH*OSHKOSH COLD STORAGE-PLYMOUTH WI*6*721~
N1*DE*LAND O LAKES*9*0062358350~
N9*LO*<?= $data['OrigRefNumber']?>~
<? foreach ( $data['lines'] as $line ) : ?>
W07*<?= $line['qtyreceived'] ?>*<?= $line['qtyMeasurementCode'] ?>*<?= $line['upcCaseCode'] ?>*<?= $line['upcQualifier']?>*<?= $line['prodnum'] ?>*LT*<?= $line['custlotno'] ?>***ZZ*0~
<?php if (!empty($line['lolExpDate'])) : $data['SECount']++; ?>
N9*ZZ*EXPIRY DATE**<?= $line['lotExpDate'] ?>~
<?php endif ?>
W20****<?= $line['weight'] ?>*N*L~
<?php if ($line['showW13Section']) : $data['SECount']++; ?>
W13*<?= $line['detailExceptionQuantity'] ?>*<?= $line['detailExceptionMeasurementUnit'] ?>*<?= $line['detailExceptionConditionCode'] ?>~
<?php endif ?>
<?php endforeach ?>
W14*<?= $data['totcases'] ?>~
SE*<?= $data['SECount'] ?>*<?= $data['STCtrlNo'] ?>~
GE*1*<?= $data['GSCtrlNo'] ?>~
IEA*1*<?= $data['ISACtrlNo'] ?>~
<?php
$filecontents = ob_get_contents();
ob_end_clean();
if (file_put_contents($filename, $filecontents))
	echo json_encode(array('success' => 1));
else
	echo json_encode(array('success' => 0, 'msg' => "Failed to write file: $filename"));

/*
================================================================================
EXAMPLE
================================================================================
-- Test result from our code
ISA*00*          *00*          *14*0833021900703  *08*006253835DFQ   *211223*1131*U*00401*000001003*0*T*>~
GS*RE*0833021900703*006253835DFQ*20211223*1131*1003*X*004010~
ST*944*1003~
W17*F*20211223*10774046*51060547~
N1*DE*LAND O LAKES*9*0062358350~
N1*WH*OSHKOSH COLD STORAGE-PLYMOUTH WI*6*721~
N9*LO*10774046~
W07*700*CA**SW*48154000034500*LT*12102021MS1***ZZ*0~
W20****30000.00*N*L~
W13*300*CA*02~
W14*700~
SE*8*1003~
GE*1*1003~
IEA*1*000001003~

ISA*00*          *00*          *14*0833021900703  *08*006253835DFQ   *211222*1048*U*00401*000000999*0*T*>~
GS*RE*0833021900703*006253835DFQ*20211222*1048*999*X*004010~
ST*944*999~
W17*F*20211222*0*51060550~
N1*DE*LAND O LAKES*9*0062358350~
N1*WH*WHSING OF WISC - WI RAPIDS*6*703~
N9*LO*0~
W07*1005*CA**SW*48154000034500*LT****ZZ*0~
N9*ZZ*EXPIRY DATE**~
W20****30000.00*N*L~
W13*5*CA*03~
W14*1005~
SE*8*999~
GE*1*999~
IEA*1*000000999~

-- Reduced example from them
ISA*00*          *00*          *14*0833021900703  *08*006253835DFP   *191022*1240*U*00403*000312700*0*P*:
GS*RE*0833021900703*006253835DFP*20191022*1240*312569*X*004030
ST*944*0001
W17*F*20191021*50896003*50896003
N1*DE*LAND O LAKES*9*0062358350
N1*WH*WHSING OF WISC - WI RAPIDS*6*703
N9*LO*4535837
W07*50*BG*003450027243*UC*78*LT*33044965.52***ZZ*O
N9*ZZ*EXPIRY DATE**20210219
W20****2755.75*N*L
W14*750
SE*52*0001
GE*1*312569
IEA*1*000312700

ISA*00*          *00*          *14*0833021900703  *08*006253835DFP   *191022*1240*U*00403*000312700*0*P*:
GS*RE*0833021900703*006253835DFP*20191022*1240*312569*X*004030
ST*944*0001
W17*F*20191021*50896003*50896003
N1*DE*LAND O LAKES*9*0062358350
N1*WH*WHSING OF WISC - WI RAPIDS*6*703
N9*LO*4535837
W07*50*BG*003450027243*UC*78*LT*33044965.25***ZZ*O
N9*ZZ*EXPIRY DATE**20210219
W20****2755.75*N*L
W07*50*BG*003450027243*UC*78*LT*33044965.38***ZZ*O
N9*ZZ*EXPIRY DATE**20210219
W20****2755.75*N*L
W07*50*BG*003450027243*UC*78*LT*33044965.39***ZZ*O
N9*ZZ*EXPIRY DATE**20210219
W20****2755.75*N*L
W07*50*BG*003450027243*UC*78*LT*33044965.40***ZZ*O
N9*ZZ*EXPIRY DATE**20210219
W20****2755.75*N*L
W07*50*BG*003450027243*UC*78*LT*33044965.41***ZZ*O
N9*ZZ*EXPIRY DATE**20210219
W20****2755.75*N*L
W07*50*BG*003450027243*UC*78*LT*33044965.42***ZZ*O
N9*ZZ*EXPIRY DATE**20210219
W20****2755.75*N*L
W07*50*BG*003450027243*UC*78*LT*33044965.43***ZZ*O
N9*ZZ*EXPIRY DATE**20210219
W20****2755.75*N*L
W07*50*BG*003450027243*UC*78*LT*33044965.44***ZZ*O
N9*ZZ*EXPIRY DATE**20210219
W20****2755.75*N*L
W07*50*BG*003450027243*UC*78*LT*33044965.45***ZZ*O
N9*ZZ*EXPIRY DATE**20210219
W20****2755.75*N*L
W07*50*BG*003450027243*UC*78*LT*33044965.46***ZZ*O
N9*ZZ*EXPIRY DATE**20210219
W20****2755.75*N*L
W07*50*BG*003450027243*UC*78*LT*33044965.47***ZZ*O
N9*ZZ*EXPIRY DATE**20210219
W20****2755.75*N*L
W07*50*BG*003450027243*UC*78*LT*33044965.48***ZZ*O
N9*ZZ*EXPIRY DATE**20210219
W20****2755.75*N*L
W07*50*BG*003450027243*UC*78*LT*33044965.49***ZZ*O
N9*ZZ*EXPIRY DATE**20210219
W20****2755.75*N*L
W07*50*BG*003450027243*UC*78*LT*33044965.50***ZZ*O
N9*ZZ*EXPIRY DATE**20210219
W20****2755.75*N*L
W07*50*BG*003450027243*UC*78*LT*33044965.52***ZZ*O
N9*ZZ*EXPIRY DATE**20210219
W20****2755.75*N*L
W14*750
SE*52*0001
GE*1*312569
IEA*1*000312700
*/
?>